{"version":3,"sources":["dist/penpal.js"],"names":["Penpal","HANDSHAKE","HANDSHAKE_REPLY","CALL","REPLY","FULFILLED","REJECTED","MESSAGE","DATA_CLONE_ERROR","ERR_CONNECTION_DESTROYED","ERR_CONNECTION_TIMEOUT","ERR_NOT_IN_IFRAME","ERR_NO_IFRAME_SRC","createDestructor","callbacks","destroyed","destroy","forEach","callback","onDestroy","push","DEFAULT_PORTS","http:","https:","URL_REGEX","opaqueOriginSchemes","getOriginFromSrc","src","find","scheme","startsWith","location","document","regexResult","exec","protocol","hostname","port","portSuffix","concat","createLogger","debug","_console","_len","arguments","length","args","Array","_key","console","log","apply","serializeError","_ref","name","message","stack","deserializeError","obj","deserializedError","Error","Object","keys","key","connectCallReceiver","info","methods","localName","local","remote","originForSending","originForReceiving","handleMessageEvent","event","source","data","penpal","origin","_event$data","methodName","id","createPromiseHandler","resolution","returnValue","returnValueIsError","postMessage","err","Promise","resolve","then","addEventListener","removeEventListener","generateId","connectCallSender","callSender","methodNames","destroyConnection","createMethodProxy","iframeRemoved","closed","e","error","code","reject","reduce","api","CHECK_IFRAME_IN_DOC_INTERVAL","connectToChild","iframe","_ref$methods","childOrigin","timeout","parent","window","_createDestructor","srcdoc","promise","resolveConnectionPromise","connectionTimeoutId","undefined","setTimeout","receiverMethodNames","destroyCallReceiver","handleMessage","child","contentWindow","receiverMethodName","destroyCallSender","clearTimeout","checkIframeInDocIntervalId","setInterval","body","contains","clearInterval","connectToParent","_ref$parentOrigin","parentOrigin","top","index"],"mappings":"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"}